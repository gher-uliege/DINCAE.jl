<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · DINCAE.jl</title><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>DINCAE.jl</a></span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#User-API"><span>User API</span></a></li><li><a class="tocitem" href="#Internal-functions"><span>Internal functions</span></a></li><li><a class="tocitem" href="#Reducing-GPU-memory-usage"><span>Reducing GPU memory usage</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/gher-ulg/DINCAE.jl/blob/main/docs/src/index.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="DINCAE.jl"><a class="docs-heading-anchor" href="#DINCAE.jl">DINCAE.jl</a><a id="DINCAE.jl-1"></a><a class="docs-heading-anchor-permalink" href="#DINCAE.jl" title="Permalink"></a></h1><p>DINCAE (Data-Interpolating Convolutional Auto-Encoder) is a neural network to reconstruct missing data in satellite observations. It can work with gridded data (<code>DINCAE.reconstruct</code>) or a clouds of points (<code>DINCAE.reconstruct_points</code>). In the later case, the data can be organized in e.g. tracks (or not).</p><p>The code is available at: <a href="https://github.com/gher-ulg/DINCAE.jl">https://github.com/gher-ulg/DINCAE.jl</a></p><p>The method is described in the following articles:</p><ul><li>Barth, A., Alvera-Azcárate, A., Licer, M., &amp; Beckers, J.-M. (2020). DINCAE 1.0: a convolutional neural network with error estimates to reconstruct sea surface temperature satellite observations. Geoscientific Model Development, 13(3), 1609–1622. https://doi.org/10.5194/gmd-13-1609-2020</li><li>Barth, A., Alvera-Azcárate, A., Troupin, C., &amp; Beckers, J.-M. (2022). DINCAE 2.0: multivariate convolutional neural network with error estimates to reconstruct sea surface temperature satellite and altimetry observations. Geoscientific Model Development, 15(5), 2183–2196. https://doi.org/10.5194/gmd-15-2183-2022</li></ul><p>The neural network will be trained on the GPU. Note convolutional neural networks can require a lot of GPU memory depending on the domain size.  So far, only NVIDIA GPUs are supported by the neural network framework Knet.jl using in DINCAE (beside training on the CPU but which prohibitively slow).</p><h2 id="User-API"><a class="docs-heading-anchor" href="#User-API">User API</a><a id="User-API-1"></a><a class="docs-heading-anchor-permalink" href="#User-API" title="Permalink"></a></h2><p>In most cases, a user does only need to interact with the function <code>DINCAE.reconstruct</code> or <code>DINCAE.reconstruct_points</code>.</p><article class="docstring"><header><a class="docstring-binding" id="DINCAE.reconstruct" href="#DINCAE.reconstruct"><code>DINCAE.reconstruct</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">reconstruct(Atype,data_all,fnames_rec;...)</code></pre><p>Train a neural network to reconstruct missing data using the training data set and periodically run the neural network on the test dataset. The data is assumed to be avaialable on a regular longitude/latitude grid (which is the case of L3 satellite data).</p><p><strong>Mandatory parameters</strong></p><ul><li><code>Atype</code>: array type to use</li><li><code>data_all</code>: list of named tuples. Every tuple should have <code>filename</code>, and <code>varname</code>.</li></ul><p><code>data_all[1]</code> will be used for training (and perturbed to prevent overfitting). All others entries <code>data_all[2:end]</code> will be reconstructed using the training network at the epochs defined by <code>save_epochs</code>.</p><ul><li><code>fnames_rec</code>: vector of filenames corresponding to the entries <code>data_all[2:end]</code></li></ul><p><strong>Optional parameters:</strong></p><ul><li><code>epochs</code>: the number of epochs (default <code>1000</code>)</li><li><code>batch_size</code>: the size of a mini-batch (default <code>50</code>)</li><li><code>enc_nfilter_internal</code>: number of filter of the internal encoding layers (default <code>[16,24,36,54]</code>)</li><li><code>skipconnections</code>: list of layers with skip connections (default <code>2:(length(enc_nfilter_internal)+1)</code>)</li><li><code>clip_grad</code>: maximum allowed gradient. Elements of the gradients larger than this values will be clipped (default <code>5.0</code>).</li><li><code>regularization_L2_beta</code>: Parameter for L2 reguliziation (default <code>0</code>, i.e. no regularization)</li><li><code>save_epochs</code>: list of epochs where the results should be saved (default <code>200:10:epochs</code>)</li><li><code>is3D</code>: Switch to apply 2D (<code>is3D == false</code>) or 3D (<code>is3D == true</code>) convolutions (default <code>false</code>)</li><li><code>upsampling_method</code>: interpolation method during upsampling which can be either <code>:nearest</code> or <code>:bilinear</code> (default <code>:nearest</code>)</li><li><code>ntime_win</code>: number of time instance within the time window. This number should be odd. (default <code>3</code>)</li><li><code>learning_rate</code>: intial learning rate of the ADAM optimizater (default <code>0.001</code>)</li><li><code>learning_rate_decay_epoch</code>: The exponential recay rate of the leaning rate. After <code>learning_rate_decay_epoch</code> the learning rate is halved. The learning rate is compute as  <code>learning_rate * 0.5^(epoch / learning_rate_decay_epoch)</code>. <code>learning_rate_decay_epoch</code> can be <code>Inf</code> for a constant learning rate (default)</li><li><code>min_std_err</code>: minimum error standard deviation preving a division close to zero (default <code>exp(-5) = 0.006737946999085467</code>)</li><li><code>loss_weights_refine</code>: The weigh of the individual refinement layers using in the cost function. </li></ul><p>If <code>loss_weights_refine</code> has a single element, then there is no refinement.  (default <code>(1.,)</code>)</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Note that also the optional parameters should be to tuned for a particular application.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gher-ulg/DINCAE.jl/blob/c343966b2a14c3df2b000929dc1a1624da46497e/src/model.jl#LL620-L660">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="DINCAE.reconstruct_points" href="#DINCAE.reconstruct_points"><code>DINCAE.reconstruct_points</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">DINCAE.reconstruct_points(T,Atype,filename,varname,grid,fnames_rec )</code></pre><p>Mandatory parameters:</p><ul><li><code>T</code>: <code>Float32</code> or <code>Float64</code>: float-type used by the neural network</li><li><code>Array{T}</code> or <code>KnetArray{T}</code>: array-type used by the neural network.</li><li><code>filename</code>: NetCDF file in the format described below.</li><li><code>varname</code>: name of the primary variable in the NetCDF file</li><li><code>grid</code>: tuple of ranges with the grid in the longitude and latitude direction e.g. <code>(-180:1:180,-90:1:90)</code>.</li><li><code>fnames_rec</code>: NetCDF file names of the reconstruction</li></ul><p>Optional parameters:</p><ul><li><code>jitter_std_pos</code>: standard deviation of the noise to be added to the position of observation (default <code>(5,5)</code>)</li><li><code>auxdata_files</code>: gridded auxillary data file for a multivariate reconstruction. <code>auxdata_files</code> is an array of named tuples with the fields (<code>filename</code>, the file name of the NetCDF file, <code>varname</code> the NetCDF name of the primary variable and <code>errvarname</code> the NetCDF name of the expected standard deviation error). For example:</li></ul><pre><code class="nohighlight hljs">auxdata_files = [
  (filename = &quot;big-sst-file.nc&quot;),
   varname = &quot;SST&quot;,
   errvarname = &quot;SST_error&quot;)]</code></pre><p>The data in the file should already be interpolated on the targed grid. The file structure of the NetCDF file is described in <code>DINCAE.load_gridded_nc</code>.</p><p>See <code>DINCAE.reconstruct</code> for other optional parameters.</p><p>An (minimal) example of the NetCDF file is:</p><pre><code class="nohighlight hljs">netcdf all-sla.train {
dimensions:
	track = 9628 ;
	time = 7445528 ;
variables:
	int64 size(track) ;
		size:sample_dimension = &quot;time&quot; ;
	double dates(track) ;
		dates:units = &quot;days since 1900-01-01 00:00:00&quot; ;
	float sla(time) ;
	float lon(time) ;
	float lat(time) ;
	int64 id(time) ;
	double dtime(time) ;
		dtime:long_name = &quot;time of measurement&quot; ;
		dtime:units = &quot;days since 1900-01-01 00:00:00&quot; ;
}</code></pre><p>The file should contain the variables <code>lon</code> (longitude), <code>lat</code> (latitude), <code>dtime</code> (time of measurement) and <code>id</code> (numeric identifier, only used by post processing scripts) and <code>dates</code> (time instance of the gridded field). The file should be in the <a href="https://cfconventions.org/cf-conventions/cf-conventions.html#_contiguous_ragged_array_representation">contiguous ragged array representation</a> as specified by the CF convention allowing to group data points into &quot;features&quot; (e.g. tracks for altimetry). Every feature can also contain a single data point.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gher-ulg/DINCAE.jl/blob/c343966b2a14c3df2b000929dc1a1624da46497e/src/points.jl#LL460-L515">source</a></section></article><h2 id="Internal-functions"><a class="docs-heading-anchor" href="#Internal-functions">Internal functions</a><a id="Internal-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Internal-functions" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="DINCAE.load_gridded_nc" href="#DINCAE.load_gridded_nc"><code>DINCAE.load_gridded_nc</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">lon,lat,time,data,missingmask,mask = load_gridded_nc(fname,varname; minfrac = 0.05)</code></pre><p>Load the variable <code>varname</code> from the NetCDF file <code>fname</code>. The variable <code>lon</code> is the longitude in degrees east, <code>lat</code> is the latitude in degrees North, <code>time</code> is a numpy datetime vector, <code>data_full</code> is a 3-d array with the data, <code>missingmask</code> is a boolean mask where true means the data is missing and <code>mask</code> is a boolean mask where true means the data location is valid, e.g. sea points for sea surface temperature.</p><p>At the bare-minimum a NetCDF file should have the following variables and attributes:</p><pre><code class="nohighlight hljs">netcdf file.nc {
dimensions:
        time = UNLIMITED ; // (5266 currently)
        lat = 112 ;
        lon = 112 ;
variables:
        double lon(lon) ;
        double lat(lat) ;
        double time(time) ;
                time:units = &quot;days since 1900-01-01 00:00:00&quot; ;
        int mask(lat, lon) ;
        float SST(time, lat, lon) ;
                SST:_FillValue = -9999.f ;
}</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gher-ulg/DINCAE.jl/blob/c343966b2a14c3df2b000929dc1a1624da46497e/src/data.jl#LL4-L31">source</a></section><section><div><p>the first variable is for isoutput is none specified</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gher-ulg/DINCAE.jl/blob/c343966b2a14c3df2b000929dc1a1624da46497e/src/data.jl#LL65-L67">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="DINCAE.NCData" href="#DINCAE.NCData"><code>DINCAE.NCData</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">dd = NCData(lon,lat,time,data_full,missingmask;
            train = false,
            obs_err_std = 1.,
            jitter_std = 0.05)</code></pre><p>Return a structure holding the data for training (<code>train = true</code>) or testing (<code>train = false</code>) the neural network. <code>obs_err_std</code> is the error standard deviation of the observations. The variable <code>lon</code> is the longitude in degrees east, <code>lat</code> is the latitude in degrees North, <code>time</code> is a numpy datetime vector, <code>data_full</code> is a 3-d array with the data and <code>missingmask</code> is a boolean mask where true means the data is missing. <code>jitter_std</code> is the standard deviation of the noise to be added to the data during training.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gher-ulg/DINCAE.jl/blob/c343966b2a14c3df2b000929dc1a1624da46497e/src/data.jl#LL180-L193">source</a></section></article><h2 id="Reducing-GPU-memory-usage"><a class="docs-heading-anchor" href="#Reducing-GPU-memory-usage">Reducing GPU memory usage</a><a id="Reducing-GPU-memory-usage-1"></a><a class="docs-heading-anchor-permalink" href="#Reducing-GPU-memory-usage" title="Permalink"></a></h2><p>Convolutional neural networks can require &quot;a lot&quot; of GPU memory. These parameters can affect GPU memory utilisation:</p><ul><li>reduce the mini-batch size</li><li>use fewer layers (e.g. <code>enc_nfilter_internal</code> = [16,24,36] or [16,24])</li><li>use less filters (reduce the values of the optional parameter enc<em>nfilter</em>internal)</li><li>use a smaller domain or lower resolution</li></ul></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Tuesday 6 September 2022 09:13">Tuesday 6 September 2022</span>. Using Julia version 1.8.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
