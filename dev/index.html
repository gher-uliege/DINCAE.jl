<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · DINCAE.jl</title><meta name="title" content="Home · DINCAE.jl"/><meta property="og:title" content="Home · DINCAE.jl"/><meta property="twitter:title" content="Home · DINCAE.jl"/><meta name="description" content="Documentation for DINCAE.jl."/><meta property="og:description" content="Documentation for DINCAE.jl."/><meta property="twitter:description" content="Documentation for DINCAE.jl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>DINCAE.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#User-API"><span>User API</span></a></li><li><a class="tocitem" href="#Internal-functions"><span>Internal functions</span></a></li><li><a class="tocitem" href="#Reducing-GPU-memory-usage"><span>Reducing GPU memory usage</span></a></li><li><a class="tocitem" href="#Troubleshooting"><span>Troubleshooting</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/gher-uliege/DINCAE.jl/blob/main/docs/src/index.md#L" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="DINCAE.jl"><a class="docs-heading-anchor" href="#DINCAE.jl">DINCAE.jl</a><a id="DINCAE.jl-1"></a><a class="docs-heading-anchor-permalink" href="#DINCAE.jl" title="Permalink"></a></h1><p>DINCAE (Data-Interpolating Convolutional Auto-Encoder) is a neural network to reconstruct missing data in satellite observations. It can work with gridded data (<code>DINCAE.reconstruct</code>) or a clouds of points (<code>DINCAE.reconstruct_points</code>). In the later case, the data can be organized in e.g. tracks (or not).</p><p>The code is available at: <a href="https://github.com/gher-uliege/DINCAE.jl">https://github.com/gher-uliege/DINCAE.jl</a></p><p>The method is described in the following articles:</p><ul><li>Barth, A., Alvera-Azcárate, A., Ličer, M., &amp; Beckers, J.-M. (2020). DINCAE 1.0: a convolutional neural network with error estimates to reconstruct sea surface temperature satellite observations. Geoscientific Model Development, 13(3), 1609–1622. https://doi.org/10.5194/gmd-13-1609-2020</li><li>Barth, A., Alvera-Azcárate, A., Troupin, C., &amp; Beckers, J.-M. (2022). DINCAE 2.0: multivariate convolutional neural network with error estimates to reconstruct sea surface temperature satellite and altimetry observations. Geoscientific Model Development, 15(5), 2183–2196. https://doi.org/10.5194/gmd-15-2183-2022</li></ul><p>The neural network will be trained on the GPU. Note convolutional neural networks can require a lot of GPU memory depending on the domain size. <a href="https://github.com/FluxML/Flux.jl"><code>Flux.jl</code></a> supports NVIDIA GPUs as well as other vendors (see https://fluxml.ai/Flux.jl/stable/gpu/ for details). Training on the CPU can be performed, but it is prohibitively slow.</p><h2 id="User-API"><a class="docs-heading-anchor" href="#User-API">User API</a><a id="User-API-1"></a><a class="docs-heading-anchor-permalink" href="#User-API" title="Permalink"></a></h2><p>In most cases, a user only needs to interact with the function <code>DINCAE.reconstruct</code> or <code>DINCAE.reconstruct_points</code>.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DINCAE.reconstruct" href="#DINCAE.reconstruct"><code>DINCAE.reconstruct</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">reconstruct(Atype,data_all,fnames_rec;...)</code></pre><p>Train a neural network to reconstruct missing data using the training data set and periodically run the neural network on the test dataset. The data is assumed to be available on a regular longitude/latitude grid (which is the case of L3 satellite data).</p><p><strong>Mandatory parameters</strong></p><ul><li><code>Atype</code>: array type to use</li><li><code>data_all</code>: list of named tuples. Every tuple should have <code>filename</code> and <code>varname</code>. <code>data_all[1]</code> will be used for training (and perturbed to prevent overfitting). All others entries <code>data_all[2:end]</code> will be reconstructed using the training network</li></ul><p>at the epochs defined by <code>save_epochs</code>.</p><ul><li><code>fnames_rec</code>: vector of filenames corresponding to the entries <code>data_all[2:end]</code></li></ul><p><strong>Optional parameters:</strong></p><ul><li><code>epochs</code>: the number of epochs (default <code>1000</code>)</li><li><code>batch_size</code>: the size of a mini-batch (default <code>50</code>)</li><li><code>enc_nfilter_internal</code>: number of filters of the internal encoding layers (default <code>[16,24,36,54]</code>)</li><li><code>skipconnections</code>: list of layers with skip connections (default <code>2:(length(enc_nfilter_internal)+1)</code>)</li><li><code>clip_grad</code>: maximum allowed gradient. Elements of the gradients larger than this values will be clipped (default <code>5.0</code>).</li><li><code>regularization_L2_beta</code>: Parameter for L2 regularization (default <code>0</code>, i.e. no regularization)</li><li><code>save_epochs</code>: list of epochs where the results should be saved (default <code>200:10:epochs</code>)</li><li><code>is3D</code>: Switch to apply 2D (<code>is3D == false</code>) or 3D (<code>is3D == true</code>) convolutions (default <code>false</code>)</li><li><code>upsampling_method</code>: interpolation method during upsampling which can be either <code>:nearest</code> or <code>:bilinear</code> (default <code>:nearest</code>)</li><li><code>ntime_win</code>: number of time instances within the time window. This number should be odd. (default <code>3</code>)</li><li><code>learning_rate</code>: initial learning rate of the ADAM optimizer (default <code>0.001</code>)</li><li><code>learning_rate_decay_epoch</code>: the exponential decay rate of the learning rate. After <code>learning_rate_decay_epoch</code> the learning rate is halved. The learning rate is computed as  <code>learning_rate * 0.5^(epoch / learning_rate_decay_epoch)</code>. <code>learning_rate_decay_epoch</code> can be <code>Inf</code> for a constant learning rate (default)</li><li><code>min_std_err</code>: minimum error standard deviation preventing a division close to zero (default <code>exp(-5) = 0.006737946999085467</code>)</li><li><code>loss_weights_refine</code>: the weigh of the individual refinement layers using in the cost function. If <code>loss_weights_refine</code> has a single element, then there is no refinement.  (default <code>(1.,)</code>)</li></ul><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Note that also the optional parameters should be to tuned for a particular application.</p></div></div><p>Internally the time mean is removed (per default) from the data before it is reconstructed. The time mean is also added back when the file is saved. However, the mean is undefined for for are pixels in the data defined as valid (sea) by the mask which do not have any valid data in the training dataset.</p><p>See <code>DINCAE.load_gridded_nc</code> for more information about the netCDF file.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gher-uliege/DINCAE.jl/blob/025f82b12edbcbaecdbe8cc2b32c8eef6492b0ab/src/model.jl#LL368-L412">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DINCAE.reconstruct_points" href="#DINCAE.reconstruct_points"><code>DINCAE.reconstruct_points</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">DINCAE.reconstruct_points(T,Atype,filename,varname,grid,fnames_rec )</code></pre><p>Mandatory parameters:</p><ul><li><code>T</code>: <code>Float32</code> or <code>Float64</code>: float-type used by the neural network</li><li><code>Array{T}</code>, <code>CuArray{T}</code>,...: array-type used by the neural network.</li><li><code>filename</code>: NetCDF file in the format described below.</li><li><code>varname</code>: name of the primary variable in the NetCDF file.</li><li><code>grid</code>: tuple of ranges with the grid in the longitude and latitude direction e.g. <code>(-180:1:180,-90:1:90)</code>.</li><li><code>fnames_rec</code>: NetCDF file names of the reconstruction.</li></ul><p>Optional parameters:</p><ul><li><code>jitter_std_pos</code>: standard deviation of the noise to be added to the position of the observations (default <code>(5,5)</code>)</li><li><code>auxdata_files</code>: gridded auxiliary data file for a multivariate reconstruction. <code>auxdata_files</code> is an array of named tuples with the fields (<code>filename</code>, the file name of the NetCDF file, <code>varname</code> the NetCDF name of the primary variable and <code>errvarname</code> the NetCDF name of the expected standard deviation error). For example:</li><li><code>probability_skip_for_training</code>: For a given time step n, every track from the same time step n will be skipped by this probability during training (default 0.2). This does not affect the tracks from previous (n-1,n-2,..) and following time steps (n+1,n+2,...). The goal of this parameter is to force the neural network to learn to interpolate the data in time.</li><li><code>paramfile</code>: the path of the file (netCDF) where the parameter values are stored (default: <code>nothing</code>).</li></ul><p>For example, a single entry of <code>auxdata_files</code> could be:</p><pre><code class="nohighlight hljs">auxdata_files = [
  (filename = &quot;big-sst-file.nc&quot;),
   varname = &quot;SST&quot;,
   errvarname = &quot;SST_error&quot;)]</code></pre><p>The data in the file should already be interpolated on the targed grid. The file structure of the NetCDF file is described in <code>DINCAE.load_gridded_nc</code>. The fields defined in this file should not have any missing value (see DIVAnd.ufill).</p><p>See <code>DINCAE.reconstruct</code> for other optional parameters.</p><p>An (minimal) example of the NetCDF file is:</p><pre><code class="nohighlight hljs">netcdf all-sla.train {
dimensions:
	time_instances = 9628 ;
	obs = 7445528 ;
variables:
	int64 size(time_instances) ;
		size:sample_dimension = &quot;obs&quot; ;
	double dates(time_instances) ;
		dates:units = &quot;days since 1900-01-01 00:00:00&quot; ;
	float sla(obs) ;
	float lon(obs) ;
	float lat(obs) ;
	int64 id(obs) ;
	double dtime(obs) ;
		dtime:long_name = &quot;time of measurement&quot; ;
		dtime:units = &quot;days since 1900-01-01 00:00:00&quot; ;
}</code></pre><p>The file should contain the variables <code>lon</code> (longitude), <code>lat</code> (latitude), <code>dtime</code> (time of measurement) and <code>id</code> (numeric identifier, only used by post processing scripts) and <code>dates</code> (time instance of the gridded field). The file should be in the <a href="https://cfconventions.org/cf-conventions/cf-conventions.html#_contiguous_ragged_array_representation">contiguous ragged array representation</a> as specified by the CF convention allowing to group data points into &quot;features&quot; (e.g. tracks for altimetry). Every feature can also contain a single data point.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gher-uliege/DINCAE.jl/blob/025f82b12edbcbaecdbe8cc2b32c8eef6492b0ab/src/points.jl#LL449-L508">source</a></section></article><h2 id="Internal-functions"><a class="docs-heading-anchor" href="#Internal-functions">Internal functions</a><a id="Internal-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Internal-functions" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DINCAE.load_gridded_nc" href="#DINCAE.load_gridded_nc"><code>DINCAE.load_gridded_nc</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">lon,lat,time,data,missingmask,mask = load_gridded_nc(fname,varname; minfrac = 0.05)</code></pre><p>Load the variable <code>varname</code> from the NetCDF file <code>fname</code>. The variable <code>lon</code> is the longitude in degrees east, <code>lat</code> is the latitude in degrees north, <code>time</code> is a DateTime vector, <code>data_full</code> is a 3-d array with the data, <code>missingmask</code> is a boolean mask where true means the data is missing and <code>mask</code> is a boolean mask where true means the data location is valid, e.g. sea points for sea surface temperature.</p><p>At the bare-minimum a NetCDF file should have the following variables and attributes:</p><pre><code class="nohighlight hljs">netcdf file.nc {
dimensions:
        time = UNLIMITED ; // (5266 currently)
        lat = 112 ;
        lon = 112 ;
variables:
        double lon(lon) ;
        double lat(lat) ;
        double time(time) ;
                time:units = &quot;days since 1900-01-01 00:00:00&quot; ;
        int mask(lat, lon) ;
        float SST(time, lat, lon) ;
                SST:_FillValue = -9999.f ;
}</code></pre><p>The the netCDF mask is 0 for invalid (e.g. land for an ocean application) and 1 for pixels (e.g. ocean).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gher-uliege/DINCAE.jl/blob/025f82b12edbcbaecdbe8cc2b32c8eef6492b0ab/src/data.jl#LL4-L33">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DINCAE.NCData" href="#DINCAE.NCData"><code>DINCAE.NCData</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">dd = NCData(lon,lat,time,data_full,missingmask,ndims;
            train = false,
            obs_err_std = fill(1.,size(data_full,3)),
            jitter_std = fill(0.05,size(data_full,3)),
            mask = trues(size(data_full)[1:2]),</code></pre><p>)</p><p>Return a structure holding the data for training (<code>train = true</code>) or testing (<code>train = false</code>) the neural network. <code>obs_err_std</code> is the error standard deviation of the observations. The variable <code>lon</code> is the longitude in degrees east, <code>lat</code> is the latitude in degrees north, <code>time</code> is a DateTime vector, <code>data_full</code> is a 3-d array with the data and <code>missingmask</code> is a boolean mask where true means the data is missing. <code>jitter_std</code> is the standard deviation of the noise to be added to the data during training.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/gher-uliege/DINCAE.jl/blob/025f82b12edbcbaecdbe8cc2b32c8eef6492b0ab/src/data.jl#LL234-L249">source</a></section></article><h2 id="Reducing-GPU-memory-usage"><a class="docs-heading-anchor" href="#Reducing-GPU-memory-usage">Reducing GPU memory usage</a><a id="Reducing-GPU-memory-usage-1"></a><a class="docs-heading-anchor-permalink" href="#Reducing-GPU-memory-usage" title="Permalink"></a></h2><p>Convolutional neural networks can require &quot;a lot&quot; of GPU memory. These parameters can affect GPU memory utilisation:</p><ul><li>reduce the mini-batch size</li><li>use fewer layers (e.g. <code>enc_nfilter_internal</code> = [16,24,36] or [16,24])</li><li>use less filters (reduce the values of the optional parameter enc<em>nfilter</em>internal)</li><li>use a smaller domain or a lower resolution</li></ul><h2 id="Troubleshooting"><a class="docs-heading-anchor" href="#Troubleshooting">Troubleshooting</a><a id="Troubleshooting-1"></a><a class="docs-heading-anchor-permalink" href="#Troubleshooting" title="Permalink"></a></h2><h3 id="Installation-of-cuDNN"><a class="docs-heading-anchor" href="#Installation-of-cuDNN">Installation of cuDNN</a><a id="Installation-of-cuDNN-1"></a><a class="docs-heading-anchor-permalink" href="#Installation-of-cuDNN" title="Permalink"></a></h3><p>If you get the warning <code>Package cuDNN not found in current path</code> or the error <code>Scalar indexing is disallowed</code>:</p><pre><code class="language-julia hljs">julia&gt; using DINCAE
┌ Warning: Package cuDNN not found in current path.
│ - Run `import Pkg; Pkg.add(&quot;cuDNN&quot;)` to install the cuDNN package, then restart julia.
│ - If cuDNN is not installed, some Flux functionalities will not be available when running on the GPU.</code></pre><p>You need to install and load <code>cuDNN</code> before calling a function in <code>DINCAE.jl</code>:</p><pre><code class="language-julia hljs">using cuDNN
using DINCAE
# ...</code></pre><h3 id="Dependencies-of-DINCAE.jl"><a class="docs-heading-anchor" href="#Dependencies-of-DINCAE.jl">Dependencies of DINCAE.jl</a><a id="Dependencies-of-DINCAE.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Dependencies-of-DINCAE.jl" title="Permalink"></a></h3><p><code>DINCAE.jl</code> depends on <code>Flux.jl</code> and <code>CUDA.jl</code>, which will automatically be installed. If you have some problems installing these package you might consult the <a href="http://fluxml.ai/Flux.jl/stable/#Installation">documentation of <code>Flux.jl</code></a> or <a href="https://cuda.juliagpu.org/stable/installation/overview/"><code>CUDA.jl</code></a>.</p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.1 on <span class="colophon-date" title="Friday 14 March 2025 13:51">Friday 14 March 2025</span>. Using Julia version 1.11.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
